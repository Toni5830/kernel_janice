***************
*** 480,486 ****
  		if (end > vma->vm_end)
  			end = vma->vm_end;
  
- 		flush_cache_user_range(vma, start, end);
  	}
  	up_read(&mm->mmap_sem);
  }
--- 480,488 ----
  		if (end > vma->vm_end)
  			end = vma->vm_end;
  
+ 		up_read(&mm->mmap_sem);
+ 		flush_cache_user_range(start, end);
+ 		return;
  	}
  	up_read(&mm->mmap_sem);
  }
